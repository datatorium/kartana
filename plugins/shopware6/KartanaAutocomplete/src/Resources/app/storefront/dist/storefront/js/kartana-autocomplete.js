(window.webpackJsonp=window.webpackJsonp||[]).push([["kartana-autocomplete"],{pi8k:function(t,e,i){"use strict";i.r(e);var n=i("w1U4"),s=i.n(n);function o(t){var e=t.name.match(/(.*)\[(zipcode|city|street)]/),i=e[1],n={zipcode:"postcode",city:"municipality",street:"street"}[e[2]];t.setAttribute("data-kartana-address",i),t.setAttribute("data-kartana-field",n)}document.querySelectorAll('input[name$="[zipcode]"], input[name$="[city]"], input[name$="[street]"]').forEach(o),s.a.init()},w1U4:function(t,e){var i,n=this&&this.__spreadArray||function(t,e){for(var i=0,n=e.length,s=t.length;i<n;i++,s++)t[s]=e[i];return t};!function(t){var e,i;!function(t){t[t.TAB=9]="TAB",t[t.RETURN=13]="RETURN",t[t.ESC=27]="ESC",t[t.UP=38]="UP",t[t.DOWN=40]="DOWN"}(e||(e={})),function(t){t.postcode="postcode",t.municipality="municipality",t.street="street"}(i=t.AddressFieldType||(t.AddressFieldType={}));var s=function(){function t(t,e){this.minDelay=t,this.maxDelay=e}return t.prototype.callNow=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];this.lastCall=Date.now(),t.apply(void 0,e)},t.prototype.callLater=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var s=0;if(void 0!==this.lastCall){var o=Date.now()-this.lastCall;s=Math.max(this.minDelay,this.maxDelay-o)}clearTimeout(this.timeoutId),this.timeoutId=setTimeout.apply(void 0,n([this.callNow,s,t],e))},t}(),o=function(){function t(t,e,i){this.endpoint=t,this.throttler=new s(e,i)}return Object.defineProperty(t,"singleton",{get:function(){return void 0===t._singleton&&(t._singleton=new t("https://api.kartana.de/public/autocomplete",200,500)),t._singleton},enumerable:!1,configurable:!0}),t.call=function(e,i){fetch(t.singleton.endpoint,{method:"POST",mode:"cors",cache:"default",credentials:"omit",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"origin",body:JSON.stringify(i)}).then((function(t){return t.json()})).then((function(t){return e(t)}))},t.cacheKey=function(t){var e={};Object.keys(t.address).forEach((function(i){var n=t.address[i];(n=(n=n.toLowerCase()).replace(/[^a-z0-9]/,"")).length>0&&(e[i]=n)}));var i={complete:t.complete,address:e};return JSON.stringify(i)},t.complete=function(e,i){var n=t.cacheKey(i);if(n in t.cache){var s=t.cache[n];e(s)}else t.singleton.throttler.callLater(t.call,(function(i){t.cache[n]=i,e(i)}),i)},t.cache={},t}(),r=function(){function t(t){this.id=t}return t.lookup=function(e,i){return void 0===i&&(i=!1),i&&!(e in t.register)&&(t.register[e]=new t(e)),t.register[e]},Object.defineProperty(t.prototype,"value",{get:function(){var t={};for(var e in i)void 0!==this[e]&&(t[e]=this[e].value);return t},set:function(t){for(var e in i)void 0!==this[e]&&void 0!==t[e]&&(this[e].value=t[e])},enumerable:!1,configurable:!0}),t.prototype.registerField=function(t){if(void 0!==this[t.fieldType])throw"Address field of type "+t.fieldType+" is already registered for address '"+this.id+"'";this[t.fieldType]=t},i.postcode,i.municipality,i.street,t.register={},t}(),h=function(){function t(t,e){this._isFocused=!1,this.combobox=e,this.element=t,this.element.classList.add("input"),this.element.setAttribute("autocomplete","off");var n=this.element.getAttribute("data-kartana-field");if(this.fieldType=i[n],void 0===this.fieldType)throw"Autocomplete is only supported for 'postcode', 'municipality' and 'street' (not '"+n+"')";var s=this.element.getAttribute("data-kartana-address");this.address=r.lookup(s,!0),this.address.registerField(this),this.element.addEventListener("focus",this.onFocus.bind(this)),this.element.addEventListener("blur",this.onBlur.bind(this)),this.element.addEventListener("input",this.onInput.bind(this))}return t.prototype.triggerSuggestions=function(){void 0!==this.fieldType&&(this.combobox.suggestionBox.open(),this.combobox.suggestionBox.requestSuggestions())},t.prototype.onInput=function(){this.triggerSuggestions()},Object.defineProperty(t.prototype,"isFocused",{get:function(){return this._isFocused},enumerable:!1,configurable:!0}),t.prototype.onFocus=function(t){this._isFocused=!0,this.triggerSuggestions()},t.prototype.onBlur=function(t){this._isFocused=!1},Object.defineProperty(t.prototype,"value",{get:function(){return this.element.value},set:function(t){this.element.value=t},enumerable:!1,configurable:!0}),t}(),a=function(){function t(t){this.isClosed=!1,this.options=[],this.element=document.createElement("ul"),this.element.classList.add("menu"),this.element.tabIndex=-1,this.combobox=t,document.addEventListener("keydown",this.handleKeyDown.bind(this))}return Object.defineProperty(t.prototype,"highlightedOption",{get:function(){return this.options[this.highlightedOptionIndex]},enumerable:!1,configurable:!0}),t.prototype.close=function(){this.isClosed=!0,this.element.classList.add("closed")},t.prototype.open=function(){this.isClosed=!1,this.element.classList.remove("closed")},t.prototype.alignRight=function(){this.element.classList.add("align-right")},t.prototype.alignLeft=function(){this.element.classList.remove("align-right")},t.prototype.align=function(){var t=document.documentElement.clientWidth,e=this.element.getBoundingClientRect(),i=e.left;t-e.right<0&&i>0?this.alignRight():this.alignLeft()},t.prototype.requestSuggestions=function(){o.complete(this.handleSuggestions.bind(this),{version:"1.1",complete:this.combobox.addressField.fieldType,address:this.combobox.addressField.address.value})},t.prototype.handleSuggestions=function(t){this.setOptions(t.suggestions)},t.prototype.reset=function(){this.options=[],this.element.innerHTML="",this.highlightedOptionIndex=void 0},t.prototype.setOptions=function(t){var e=this;if(this.reset(),t.forEach((function(t,i){var n=new d(e,i,t);e.options.push(n),e.element.appendChild(n.element)})),this.options.length>0){this.highlightOption(0);var i=new l;this.element.appendChild(i.element),this.align()}},t.prototype.handleKeyDown=function(t){if(this.combobox.isFocused){var i=!1;t.keyCode===e.DOWN?(this.open(),this.highlightNextOption(),i=!0):t.keyCode===e.UP?(this.open(),this.highlightPreviousOption(),i=!0):t.keyCode==e.RETURN?(this.isClosed||this.selectOption(this.highlightedOption),i=!0):t.keyCode==e.TAB?this.isClosed||void 0===this.highlightedOptionIndex||this.selectOption(this.highlightedOption):t.keyCode==e.ESC&&this.close(),i&&(t.preventDefault(),t.stopPropagation())}},t.prototype.highlightOption=function(t){void 0!==this.highlightedOptionIndex&&this.options[this.highlightedOptionIndex].unhighlight(),this.highlightedOptionIndex=t,this.options[this.highlightedOptionIndex].highlight()},t.prototype.highlightNextOption=function(){this.highlightedOptionIndex<this.options.length-1&&this.highlightOption(this.highlightedOptionIndex+1)},t.prototype.highlightPreviousOption=function(){this.highlightedOptionIndex>0&&this.highlightOption(this.highlightedOptionIndex-1)},t.prototype.selectOption=function(t){this.highlightOption(t.index),this.combobox.addressField.address.value=t.address},t}(),l=function(){this.element=document.createElement("div"),this.element.classList.add("acknowledgement"),this.element.innerHTML='<a href="https://kartana.de" title="Autovervollständigung für Adressformulare" tabindex="-1">Kartana Adressformular</a>'},d=function(){function t(t,e,i){this.address=i,this.suggestionBox=t,this.element=this.createElement(),this.element.classList.add("option"),this.index=e,this.element.addEventListener("click",this.onClick.bind(this))}return Object.defineProperty(t.prototype,"matchesContext",{get:function(){var t=this.suggestionBox.combobox.addressField.fieldType,e=this.suggestionBox.combobox.addressField.address.value;return t==i.postcode&&0===this.address[i.municipality].indexOf(e[i.municipality])||t==i.municipality&&0===this.address[i.postcode].indexOf(e[i.postcode])||t==i.street&&0===this.address[i.postcode].indexOf(e[i.postcode])&&0===this.address[i.municipality].indexOf(e[i.municipality])},enumerable:!1,configurable:!0}),t.prototype.createElement=function(){var t,e,n=document.createElement("li"),s=this.matchesContext?"context-match":"no-context-match";switch(n.classList.add(s),this.suggestionBox.combobox.addressField.fieldType){case i.postcode:t=this.address[i.postcode],e=this.address[i.municipality],n.innerHTML='<span class="value">'+t+'</span> <span class="context">'+e+"</span>";break;case i.municipality:t=this.address[i.municipality],e=this.address[i.postcode],n.innerHTML='<span class="context">'+e+'</span> <span class="value">'+t+"</span>";break;case i.street:t=this.address[i.street],e=this.address[i.postcode]+" "+this.address[i.municipality],n.innerHTML='<span class="value">'+t+'</span><br /><span class="context">'+e+"</span>"}return n},Object.defineProperty(t.prototype,"isHighlighted",{get:function(){return this.element.classList.contains("highlighted")},enumerable:!1,configurable:!0}),t.prototype.highlight=function(){this.isHighlighted||(this.element.classList.add("highlighted"),this.suggestionBox.element.scrollTop=this.element.offsetTop-this.suggestionBox.element.offsetHeight+this.element.offsetHeight)},t.prototype.unhighlight=function(){this.isHighlighted&&this.element.classList.remove("highlighted")},t.prototype.onClick=function(t){this.suggestionBox.selectOption(this)},t}(),c=function(){function t(t){this.element=document.createElement("div"),this.element.classList.add("kartana"),this.element.classList.add("combobox"),t.insertAdjacentElement("beforebegin",this.element),this.element.appendChild(t),this.addressField=new h(t,this),this.suggestionBox=new a(this),this.element.appendChild(this.suggestionBox.element)}return Object.defineProperty(t.prototype,"isFocused",{get:function(){return this.addressField.isFocused},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{set:function(t){this.addressField.value=t},enumerable:!1,configurable:!0}),t}();t.Combobox=c,t.init=function(){document.querySelectorAll("input[data-kartana-field]").forEach((function(t){return new c(t)}))},t.Address=r}(i||(i={})),t.exports=i}},[["pi8k","runtime"]]]);